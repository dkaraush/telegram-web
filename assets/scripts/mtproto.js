for(var API_ID=777307,API_HASH="6d792ccd89d1daacd3c6dd41069a8b72",servers=["pluto","venus","aurora","vesta","flora"],publicKeys=[{modulus:"c150023e2f70db7985ded064759cfecf0af328e69a41daf4d6f01b538135a6f91f8f8b2a0ec9ba9720ce352efcf6c5680ffc424bd634864902de0b4bd6d49f4e580230e3ae97d95c8b19442b3c0a10d8f5633fecedd6926a7f6dab0ddb7d457f9ea81b8465fcd6fffeed114011df91c059caedaf97625f6c96ecc74725556934ef781d866b34f011fce4d835a090196e9a5f0e4449af7eb697ddb9076494ca5f81104a305b6dd27665722c46b60e5df680fb16b210607ef217652e60236c255f6a28315f4083a96791d7214bf64c1df4fd0db1944fb26a2a57031b32eee64ad15a8ba68885cde74a5bfc920f6abf59ba5c75506373e7130f9042da922179251f",
exponent:"010001"},{modulus:"aeec36c8ffc109cb099624685b97815415657bd76d8c9c3e398103d7ad16c9bba6f525ed0412d7ae2c2de2b44e77d72cbf4b7438709a4e646a05c43427c7f184debf72947519680e651500890c6832796dd11f772c25ff8f576755afe055b0a3752c696eb7d8da0d8be1faf38c9bdd97ce0a77d3916230c4032167100edd0f9e7a3a9b602d04367b689536af0d64b613ccba7962939d3b57682beb6dae5b608130b2e52aca78ba023cf6ce806b1dc49c72cf928a7199d22e3d7ac84e47bc9427d0236945d10dbd15177bab413fbf0edfda09f014c7a7da088dde9759702ca760af2b8e4e97cc055c617bd74c3d97008635b98dc4d621b4891da9fb0473047927",
exponent:"010001"},{modulus:"bdf2c77d81f6afd47bd30f29ac76e55adfe70e487e5e48297e5a9055c9c07d2b93b4ed3994d3eca5098bf18d978d54f8b7c713eb10247607e69af9ef44f38e28f8b439f257a11572945cc0406fe3f37bb92b79112db69eedf2dc71584a661638ea5becb9e23585074b80d57d9f5710dd30d2da940e0ada2f1b878397dc1a72b5ce2531b6f7dd158e09c828d03450ca0ff8a174deacebcaa22dde84ef66ad370f259d18af806638012da0ca4a70baa83d9c158f3552bc9158e69bf332a45809e1c36905a5caa12348dd57941a482131be7b2355a5f4635374f3bd3ddf5ff925bf4809ee27c1e67d9120c5fe08a9de458b1b4a3c5d0a428437f2beca81f4e2d5ff",
exponent:"010001"},{modulus:"b3f762b739be98f343eb1921cf0148cfa27ff7af02b6471213fed9daa0098976e667750324f1abcea4c31e43b7d11f1579133f2b3d9fe27474e462058884e5e1b123be9cbbc6a443b2925c08520e7325e6f1a6d50e117eb61ea49d2534c8bb4d2ae4153fabe832b9edf4c5755fdd8b19940b81d1d96cf433d19e6a22968a85dc80f0312f596bd2530c1cfb28b5fe019ac9bc25cd9c2a5d8a0f3a1c0c79bcca524d315b5e21b5c26b46babe3d75d06d1cd33329ec782a0f22891ed1db42a1d6c0dea431428bc4d7aabdcf3e0eb6fda4e23eb7733e7727e9a1915580796c55188d2596d2665ad1182ba7abf15aaa5a8b779ea996317a20ae044b820bff35b6e8a1",
exponent:"010001"},{modulus:"be6a71558ee577ff03023cfa17aab4e6c86383cff8a7ad38edb9fafe6f323f2d5106cbc8cafb83b869cffd1ccf121cd743d509e589e68765c96601e813dc5b9dfc4be415c7a6526132d0035ca33d6d6075d4f535122a1cdfe017041f1088d1419f65c8e5490ee613e16dbf662698c0f54870f0475fa893fc41eb55b08ff1ac211bc045ded31be27d12c96d8d3cfc6a7ae8aa50bf2ee0f30ed507cc2581e3dec56de94f5dc0a7abee0be990b893f2887bd2c6310a1e0a9e3e38bd34fded2541508dc102a9c9b4c95effd9dd2dfe96c29be647d6c69d66ca500843cfaed6e440196f1dbe0e2e22163c61ca48c79116fa77216726749a976a1c4b0944b5121e8c01",
exponent:"010001"}],i=0;i<publicKeys.length;++i)publicKeys[i].fingerprint=publicKeyFingerprint(publicKeys[i]);window.Schema={constructors:[],constructorsIndex:{},methods:[]};var protos=[];
load("assets/tl.json",function(a,b){if(a){console.log("schema loaded");b=JSON.parse(b);for(var c=0;c<b.constructors.length;++c)window.Schema.constructorsIndex[b.constructors[c].id]=window.Schema.constructors.length,window.Schema.constructors.push(b.constructors[c]);for(c=0;c<b.methods.length;++c)window.Schema.methods.push(b.methods[c]);for(c=0;c<protos.length;++c)protos[c].sendLast()}else console.error("Error retrieving TL schema.")});
parseTL("resPQ nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector long = ResPQ","server_DH_params_fail nonce:int128 server_nonce:int128 new_nonce_hash:int128 = Server_DH_Params","server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:bytes = Server_DH_Params","server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:bytes g_a:bytes server_time:int = Server_DH_inner_data","p_q_inner_data#83c95aec pq:bytes p:bytes q:bytes nonce:int128 server_nonce:int128 new_nonce:int256 = P_Q_inner_data",
"client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:bytes = Client_DH_Inner_Data","dh_gen_ok nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer","dh_gen_retry nonce:int128 server_nonce:int128 new_nonce_hash2:int128 = Set_client_DH_params_answer","dh_gen_fail nonce:int128 server_nonce:int128 new_nonce_hash3:int128 = Set_client_DH_params_answer","bad_msg_notification#a7eff811 bad_msg_id:long bad_msg_seqno:int error_code:int = BadMsgNotification;",
"bad_server_salt#edab447b bad_msg_id:long bad_msg_seqno:int error_code:int new_server_salt:long = BadMsgNotification;","message#0200f00d msg_id:long seqno:int bytes:int body:Object = Message","msg_container#73f1f8dc messages:vector %Message = MessageContainer;","msg_copy#e06046b2 orig_message:Message = MessageCopy;","pong#347773c5 msg_id:long ping_id:long = Pong;","msgs_state_info#04deb57d req_msg_id:long info:string = MsgsStateInfo;","future_salts#ae500895 req_msg_id:long now:int salts:vector future_salt = FutureSalts;",
"future_salt#0949d9dc valid_since:int valid_until:int salt:long = FutureSalt;","gzip_packed#3072cfa1 packed_data:string = Object;","new_session_created#9ec20908 first_msg_id:long unique_id:long server_salt:long = NewSession","ping_delay_disconnect#f3427b8c ping_id:long disconnect_delay:int = Pong;","rpc_answer_unknown#5e2ad36e = RpcDropAnswer;","rpc_answer_dropped_running#cd78e586 = RpcDropAnswer;","rpc_answer_dropped#a43ad8b7 msg_id:long seq_no:int bytes:int = RpcDropAnswer;","rpc_error#2144ca19 error_code:int error_message:string = RpcError;",
"rpc_result#f35c6d01 req_msg_id:long result:Object = RpcResult;","msgs_all_info#8cc0d131 msg_ids:Vector long info:string = MsgsAllInfo","msgs_ack#62d6b459 msg_ids:Vector long = MsgsAck;","msg_detailed_info#276d3ec6 msg_id:long answer_msg_id:long bytes:int status:int = MsgDetailedInfo;","msg_new_detailed_info#809db6df answer_msg_id:long bytes:int status:int = MsgDetailedInfo;","---functions---","req_pq_multi nonce:int128 = ResPQ","set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:bytes = Set_client_DH_params_answer",
"req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:bytes q:bytes public_key_fingerprint:long encrypted_data:bytes = Server_DH_Params","ping#7abe77ec ping_id:long = Pong;","msgs_state_req#da69fb52 msg_ids:Vector long = MsgsStateReq;","get_future_salts#b921bd04 num:int = FutureSalts;","rpc_drop_answer#58e4a740 req_msg_id:long = RpcDropAnswer;","msg_resend_req#7d861a08 msg_ids:Vector long = MsgResendReq;","msg_resend_ans_req#8610baeb msg_ids:Vector long = MsgResendReq;","msgs_ack#62d6b459 msg_ids:Vector long = MsgsAck;");
var funcs=!1;function parseTL(){for(var a=arr(arguments).join("\n").split(/\n|;/g),b=0;b<a.length;++b)parseTLString(a[b])}
function parseTLString(a){0<=a.indexOf("---functions---")&&(funcs=!0);if(0<=a.indexOf("=")){a=a.replace(/\/\/.+$/g,"");var b=a.substring(0,a.indexOf(" ")),c=a.match(/([\w\d]+:[%\w\d ]+ )/g),d=[];if(null!=c)for(var f=0;f<c.length;++f){var g=c[f],h=g.substring(0,g.indexOf(":"));g=g.substring(g.indexOf(":")+1,g.length-1);d.push({name:h,type:g})}a=a.substring(a.indexOf("=")+2);funcs?putMethod(b,d,a):putType(b,d,a)}}
var MTProto=Class.extend({constructor:function(a){protos.push(this);this.main=a.main||!1;this.test=a.test||!1;this.timeOffset=0;this.socket=null;this._debug=a.debug||!1;this.DC=a.DC||-1;this.auth_key=a.auth_key;"string"===typeof this.auth_key&&(this.auth_key=S64(this.auth_key));this.lastMessageID=[0,0];this.serverPublicKey=this.q=this.p=this.pq=this.server_nonce=this.client_nonce=null;this.obfuscate=a.obfuscate||!0;this.transportName=a.transport||"intermediate";this.decryption=this.encryption=null;
this.transportSeqno=0;this.transportHeaders={abridged:B("ef"),intermediate:B("eeeeeeee"),"padded intermediate":B("dddddddd"),full:null};this.connected=!1;this.before=null;this.ready=!1;this.buffer=new ArrayBuffer;this.acks=[];this.pending={};this.sending=[];this.sent={};this.lastMsgId=null;this.attempts=0;this.updateListeners={};a=this.DC;this.load();this.DC!=a&&-1!=a&&(this.auth_key=null,this.DC=a);var b=this;b.garbageInterval=setInterval(function(){b.collectGarbage()},5E3);b.ackInterval=setInterval(function(){b.ack()},
2E3);this.debug("born.")},debug:function(){this._debug&&console.log.apply(this,[this.prefix()].concat(arr(arguments)))},debugBinary:function(a,b){if(this._debug)console[console.debug?"debug":"log"](this.prefix(),a,"["+b.byteLength+"]",S(b))},warn:function(){console.warn.apply(this,[this.prefix()].concat(arr(arguments)))},prefix:function(){return"[MTProto-"+(this.DC||"?")+(this.main?"-MAIN":"")+"]"},connect:function(a){var b=this;-1==b.DC&&(b.DC=1);b.transportSeqno=0;b.buffer=new ArrayBuffer;b.retryID=
0;b.socket=new WebSocket("wss://"+servers[b.DC-1]+".web.telegram.org/apiws"+(this.test?"_test":""),["binary"]);b.socket.binaryType="arraybuffer";b.connected=!1;b.inited=!1;b.socket.onopen=function d(){b.debug("socket opened. ("+b.socket.readyState+")");if(b.socket.readyState){var f=b.transportHeader();f&&b.sendRaw(f);null==b.auth_key?(b.client_nonce=secureRandomBytes(16),b.sendMethod("req_pq_multi",{nonce:b.client_nonce})):("function"===typeof a&&a(),b.connected=!0,"function"===typeof b.before?b.before(function(){b.connected&&
(b.ready=!0);b.sendLast()}):b.ready=!0,b.sendLast())}else setTimeout(d,500)};b.socket.onclose=function(){b.debug("socket closed.");b.connect(b.connected?a:!1);b.ready=!1;b.connected=!1};b.socket.onmessage=function(a){readAsArrayBuffer(a.data,function(a){b.obfuscate&&(a=b.decrypt(a));b.buffer=concat(b.buffer,a);b.readMessages()})}},sendLast:function(){if(this.connected&&!(50>window.Schema.constructors.length)&&this.ready){for(var a=0;a<this.sending.length;++a)this.sendAPIMethod.apply(this,this.sending[a]);
this.sending=[]}},readMessages:function(){if("intermediate"==this.transportName||"padded intermediate"==this.transportName)for(;4<this.buffer.byteLength;){var a=(new Int32Array(this.buffer.slice(0,4)))[0];if(a+4<=this.buffer.byteLength)this.parseMessage(this.buffer.slice(4,4+a)),this.buffer=this.buffer.slice(4+a);else break}else if("abridged"==this.transportName)for(;1<this.buffer.byteLength;){a=this.buffer.slice(0,1);if("7f"==S(a)){if(4>this.buffer.byteLength)break;a=4*(new Int32Array(concat(this.buffer.slice(1,
4),zeroBytes(1))))[0];var b=4}else a=new Int8Array(a),b=2;if(a+b<=this.buffer.byteLength)this.parseMessage(this.buffer.slice(b,b+a)),this.buffer=this.buffer.slice(b+a);else break}},collectGarbage:function(){for(var a in this.sent)6E4<Date.now()-this.sent[a].t&&delete this.sent[a]},listenUpdates:function(a){var b=~~(9999*Math.random());this.updateListeners[b]=a;return b},forgetUpdates:function(a){this.updateListeners[a]&&delete this.updateListeners[a]},parseMessage:function(a){if(4==a.byteLength){var b=
(new Int32Array(a))[0];this.warn("received error:",b);-404==b&&null==this.auth_key&&2>this.attempts?(this.attempts++,this.connect()):-404==b&&null!=this.auth_key&&(this.auth_key=null,this.sent[this.lastMsgId]&&(this.sending.push(this.sent[this.lastMsgId].args),this.lastMsgId=null),this.connect())}else if(null==this.auth_key){a.slice(0,8);a.slice(8,16);b=(new Int32Array(a.slice(16,20)))[0];a=a.slice(20,20+b);a=new TLDeserialization(a);var c=a.fetchObject("Object");this.debug('received "'+c._+'"',c);
this.onMessage(c)}else{var d=a.slice(0,8);c=a.slice(8,24);b=a.slice(24);this.debugBinary("auth_key_id:",d);this.debugBinary("msg_key:",c);this.debugBinary("encrypted_data:",b);S(d)!=S(B(sha1(this.auth_key)).slice(-8))&&console.warn("wrong auth_key_id received");a=B(sha256(concat(c,this.auth_key.slice(8,44))));d=B(sha256(concat(this.auth_key.slice(48,84),c)));c=concat(a.slice(0,8),d.slice(8,24),a.slice(24,32));a=concat(d.slice(0,8),a.slice(8,24),d.slice(24,32));c=(new Uint8Array(bytesFromWords(CryptoJS.AES.decrypt({ciphertext:bytesToWords(b)},
bytesToWords(c),{iv:bytesToWords(a),padding:CryptoJS.pad.NoPadding,mode:CryptoJS.mode.IGE})))).buffer;this.debugBinary("data:",c);d=c.slice(0,8);var f=c.slice(8,16);a=c.slice(16,24);b=S(a);var g=c.slice(24,28),h=(new Int32Array(c.slice(28,32)))[0];this.debugBinary("server_salt:",d);this.debugBinary("session_id:",f);this.debugBinary("message_id:",a);this.debugBinary("message_seqno:",g);a=c.slice(32,32+h);this.debugBinary("message_data:",a);a=new TLDeserialization(a);c=a.fetchObject("Object");this.debug('received "'+
c._+'"',c);if("bad_server_salt"==c._)this.server_salt=c.new_server_salt,this.save({server_salt:this.server_salt}),this.debug("saved new server_salt"),b=S(c.bad_msg_id),this.sent[b]&&(this.sendAPIMethod.apply(this,this.sent[b].args),delete this.sent[b]);else if("bad_msg_notification"==c._)this.warn("bad_msg_notification",c);else if("msg_container"==c._)for(d=0;d<c.messages.length;++d)a=c.messages[d],a.body&&(a=a.body),this.onMessage(a,b);else this.onMessage(c,b)}},ack:function(){this.connected?0<this.acks.length&&
(this.sendMethod("msgs_ack",{msg_ids:map(this.acks,B)}),this.acks=[]):this.acks=[]},onMessage:function(a,b){if(null!=this.auth_key)if("rpc_result"==a._){var c=a.result,d=S(a.req_msg_id);if("undefined"!==typeof this.pending[d]){var f=this.pending[d].type,g=c._;if("rpc_error"==c._)this.acks.push(b),this.pending[d].callback(!1,c);else{for(var h=0;h<window.Schema.constructors.length;++h){var k=window.Schema.constructors[h];if(k.predicate==g&&k.type==f){this.acks.push(b);this.pending[d].callback(!0,c);
delete this.pending[d];return}}this.warn("wrong type received",c._,"(should be",this.pending[d].type,")");this.acks.push(b);this.pending[d].callback(!1,Error("wrong type"))}delete this.pending[d]}}else if("new_session_created"==a._)this.server_salt=(new Uint8Array(a.server_salt)).buffer,this.save({server_salt:this.server_salt}),this.acks.push(b);else{if("update"==a._.slice(0,6)){for(c in this.updateListeners)this.updateListeners[c](a);this.acks.push(b)}}else if("resPQ"===a._&&null==this.auth_key){S(a.nonce)!==
S(this.client_nonce)&&this.warn("received different client nonce");this.server_nonce=a.server_nonce;this.pq=Braw(a.pq);this.debugBinary("PQ:",this.pq);var e=this;decomposePQ(this.pq,function(b){e.p=B(b.p,4);e.q=B(b.q,4);var c=bigInt(b.p,16);b=bigInt(b.q,16);0<c.compareTo(b)&&(c=e.q,e.q=e.p,e.p=c,e.debug("q should be bigger!"));e.debugBinary("P:",e.p);e.debugBinary("Q:",e.q);e.serverPublicKey=selectPublicKey(publicKeys,a.server_public_key_fingerprints);e.debug("selected public key:",e.serverPublicKey);
e.new_nonce=secureRandomBytes(32);c=serializeObject("p_q_inner_data",{pq:e.pq,p:e.p,q:e.q,nonce:e.client_nonce,server_nonce:e.server_nonce,new_nonce:e.new_nonce});e.debugBinary("inner_data:",c);e.debug(new Uint8Array(B(sha1(c))));e.debugBinary("inner_data_hash:",B(sha1(c)));c=concat(B(sha1(c)),c,randomBytes(235-c.byteLength));e.debugBinary("data_with_hash:",c);c=encryptRSA(c,e.serverPublicKey);e.debugBinary("encrypted_data: ",c);e.sendMethod("req_DH_params",{nonce:e.client_nonce,server_nonce:e.server_nonce,
p:e.p,q:e.q,public_key_fingerprint:B(e.serverPublicKey.fingerprint),encrypted_data:c})})}else"server_DH_params_ok"==a._&&null==a.auth_key?(S(a.nonce)!==S(this.client_nonce)&&this.warn("received different client nonce"),S(a.server_nonce)!==S(this.server_nonce)&&this.warn("received different server nonce"),c=a.encrypted_answer,this.tmp_aes_key=concat(B(sha1(concat(this.new_nonce,this.server_nonce))),B(sha1(concat(this.server_nonce,this.new_nonce))).slice(0,12)),this.debugBinary("tmp_aes_key",this.tmp_aes_key),
this.tmp_aes_iv=concat(B(sha1(concat(this.server_nonce,this.new_nonce))).slice(12,20),B(sha1(concat(this.new_nonce,this.new_nonce))),this.new_nonce.slice(0,4)),this.debugBinary("tmp_aes_iv",this.tmp_aes_iv),d=(new Uint8Array(bytesFromWords(CryptoJS.AES.decrypt({ciphertext:bytesToWords(c)},bytesToWords(this.tmp_aes_key),{iv:bytesToWords(this.tmp_aes_iv),padding:CryptoJS.pad.NoPadding,mode:CryptoJS.mode.IGE})))).buffer,c=d.slice(0,20),d=d.slice(20),this.debugBinary("answer_hash:",c),this.debugBinary("answer_data:",
d),f=new TLDeserialization(d),g=f.fetchObject("server_DH_inner_data"),this.debug("answer:",g),h=g.server_time-~~(Date.now()/1E3),10<Math.abs(h)&&(this.timeOffset=h,this.debug("time offset:",this.timeOffset,"seconds"),this.save({timeOffset:this.timeOffset})),this.lastMessageID=[0,0],this.g=bigInt(g.g),S(g.nonce)!=S(this.client_nonce)&&this.warn("client_nonce are different"),S(g.server_nonce)!=S(this.server_nonce)&&this.warn("server_nonce are different"),this.debug("dh_prime:",S(g.dh_prime)),"c71caeb9c6b1c9048e6c522f70f13f73980d40238e3e21c14934d037563d930f48198a0aa7c14058229493d22530f4dbfa336f6e0ac925139543aed44cce7c3720fd51f69458705ac68cd4fe6b6b13abdc9746512969328454f18faf8c595f642477fe96bb2a941d5bcd1d4ac8cc49880708fa9b378e3c4f3a9060bee67cf9a4a4a695811051907e162753b56b0f6b410dba74d8a84b2a14b3144e0ef1284754fd17ed950d5965b4b9dd46582db1178d169c6bc465b0d6ff9ca3928fef5b9ae4e418fc15e83ebea0f87fa9ff5eed70050ded2849f47bf959d956850ce929851f0d8115f635b105ee2e4e15d04b2454bf6f4fadf034b10403119cd8e3b92fcc5b"!==
S(g.dh_prime)&&this.warn("dh_prime is unknown"),this.gA=bigInt(S(g.g_a),16),this.dh_prime=bigInt(S(g.dh_prime),16),0>=this.gA.compare(bigInt(1))&&this.warn("g_a <= 1"),0<=this.gA.compare(this.dh_prime.minus(1))&&this.warn("g_a >= dh_prime - 1"),g=bigInt("1"+repeatString("0",496),16),0>this.gA.compare(g)&&this.warn("g_a < 2^1984"),0<=this.gA.compare(this.dh_prime.minus(g))&&this.warn("g_a > dh_prime - 2^1984"),sha1(d.slice(0,f.offset))!=S(c)&&this.warn("hash of data mismatch"),this.b=bigInt(S(secureRandomBytes(256)),
16),this.debug("B:",this.b.toString(16)),e=this,EuclideanModPow(this.g,this.b,this.dh_prime,function(a){e.gB=a;a=serializeObject("client_DH_inner_data",{nonce:e.client_nonce,server_nonce:e.server_nonce,retry_id:B(str(e.retryID),8),g_b:B(e.gB.toString(16),256)});e.debugBinary("inner_data:",a);var b=16-(a.byteLength+20)%16;a=concat(B(sha1(a)),a,randomBytes(b));e.debugBinary("data_with_hash:",a);a=(new Uint8Array(bytesFromWords(CryptoJS.AES.encrypt(bytesToWords(a),bytesToWords(e.tmp_aes_key),{iv:bytesToWords(e.tmp_aes_iv),
padding:CryptoJS.pad.NoPadding,mode:CryptoJS.mode.IGE}).ciphertext))).buffer;e.sendMethod("set_client_DH_params",{nonce:e.client_nonce,server_nonce:e.server_nonce,encrypted_data:a})})):"dh_gen_ok"==a._&&null==this.auth_key&&(S(a.nonce)!==S(this.client_nonce)&&this.warn("received different client nonce"),S(a.server_nonce)!==S(this.server_nonce)&&this.warn("received different server nonce"),this.auth_key=B(str(this.gA.modPow(this.b,this.dh_prime)),256),this.debugBinary("auth_key:",this.auth_key),this.auth_key_hash=
B(sha1(this.auth_key.slice(0,64)),20),this.debugBinary("auth_key_hash:",this.auth_key_hash),this.server_salt=xor(this.new_nonce.slice(0,8),this.server_nonce.slice(0,8)),this.debugBinary("server_salt:",this.server_salt),this.attempts=0,this.save({auth_key:this.auth_key,server_salt:this.server_salt,msg_seqno:0,DC:this.DC}),this.connected=!0,"function"===typeof this.before?(e=this,e.before(function(){e.connected&&(e.ready=!0);e.sendLast()})):this.ready=!0,this.sendLast())},save:function(a){var b=Storage.get("mtproto-"+
this.DC,{}),c;for(c in a)a[c]instanceof ArrayBuffer&&(a[c]="x"+S(a[c])),b[c]=a[c];Storage.set("mtproto-"+this.DC,b)},load:function(){var a=Storage.get("mtproto-"+this.DC,{}),b;for(b in a)1<a[b].length&&"x"==a[b][0]&&(a[b]=B(a[b].slice(1))),this[b]=a[b]},sendRaw:function(a){this.socket.send(a)},send:function(a,b){if(2<=this.socket.readyState){var c=this;c.connect(function(){c.send(a,b)})}else{var d=this.message(a,b);a=d.buffer;d=d.msg_id;a=this.transport(a);this.obfuscate&&(a=this.encrypt(a));this.socket.send(a);
return d}},sendMethod:function(a,b,c){this.lastMethodSent=a;this.debug('sending "'+a+'"',b);a=serializeMethod(a,b);this.debugBinary("binary message:",a);return this.send(a,c)},sendAPIMethod:function(a,b,c,d){if(!this.connected||!d&&!this.ready||50>window.Schema.constructors.length)this.sending.push(arr(arguments));else{for(var f=null,g=0;g<window.Schema.methods.length;++g)if(window.Schema.methods[g].method==a){f=window.Schema.methods[g];break}null==f?(this.warn("failed to find method:",a),c(!1,Error("Failed to find method."))):
(g=this.sendMethod(a,b,!0),this.pending[g]={type:f.type,callback:c},this.sent[g]={args:arr(arguments),t:Date.now()})}},encrypt:function(a){return this.obfuscate?this.encryption.encrypt(new Uint8Array(a)).buffer:a},decrypt:function(a){return this.obfuscate?this.decryption.decrypt(new Uint8Array(a)).buffer:a},message:function(a,b){if(null==this.auth_key){var c=this.messageID();return{buffer:concat(zeroBytes(8),c,int32(a.byteLength),a),msg_id:c}}null==this.session_id&&(this.session_id=randomBytes(8));
!this.inited&&b&&(c=new TLSerialization,c.storeInt(3667594509,"invokeWithLayer"),c.storeInt(105,"layer"),c.storeInt(3343392166,"initConnection"),c.storeInt(API_ID,"api_id"),c.storeString(navigator.userAgent||"Unknown UserAgent","device_model"),c.storeString(navigator.platform||"Unknown Platform","system_version"),c.storeString("0.1.0","app_version"),c.storeString(navigator.language||"en","system_lang_code"),c.storeString("","lang_pack"),c.storeString(navigator.language||"en","lang_code"),a=concat(c.getBuffer(),
a),this.inited=!0);c=this.messageID();var d=this.messageSeqno(!b);this.debugBinary("salt:",this.server_salt);this.debugBinary("session_id:",this.session_id);this.debugBinary("message_id:",c);this.debugBinary("message_seqno:",d);d=concat(this.server_salt,this.session_id,c,d,int32(a.byteLength),a);var f=concat(d,randomBytes(16-d.byteLength%16+16*rand(1,50)));this.debugBinary("message:",f);d=B(sha256(concat(this.auth_key.slice(88,120),f))).slice(8,24);var g=B(sha1(this.auth_key)).slice(-8),h=B(sha256(concat(d,
this.auth_key.slice(0,36))));this.debugBinary("sha256_content:",concat(d,this.auth_key.slice(0,36)));this.debugBinary("sha256_a:",h);var k=B(sha256(concat(this.auth_key.slice(40,76),d)));this.debugBinary("sha256_content:",concat(this.auth_key.slice(40,76),d));this.debugBinary("sha256_b:",k);var e=concat(h.slice(0,8),k.slice(8,24),h.slice(24,32));h=concat(k.slice(0,8),h.slice(8,24),k.slice(24,32));f=(new Uint8Array(bytesFromWords(CryptoJS.AES.encrypt(bytesToWords(f),bytesToWords(e),{iv:bytesToWords(h),
padding:CryptoJS.pad.NoPadding,mode:CryptoJS.mode.IGE}).ciphertext))).buffer;this.debugBinary("auth_key_id:",g);this.debugBinary("msg_key:",d);this.debugBinary("encrypted_data:",f);this.lastMsgId=S(c);return{buffer:concat(g,d,f),msg_id:S(c)}},messageSeqno:function(a){null==this.msg_seqno&&(this.msg_seqno=0);var b=2*this.msg_seqno;a||(b++,this.msg_seqno++);return int32([b])},messageID:function(){var a=now();this.lastMessageID=a=[Math.floor(a/1E3)+this.timeOffset,a%1E3<<21|~~(65535*Math.random())<<
3|4];this.debug("messageID: ",a);return(new Int32Array(a.reverse())).buffer},transport:function(a){if("abridged"===this.transportName)return 127<=a.byteLength/4?concat(B("7f"),int32(a.byteLength/4).slice(0,3),a):concat(int8(a.byteLength/4),a);if("intermediate"===this.transportName)return this.debugBinary("payload:",a),concat(int32(a.byteLength),a);if("padded intermediate"===this.transportName){var b=rand(0,15),c=randomBytes(b);return concat(int32(a.byteLength+b),a,c)}if("full"===this.transportName)return b=
this.transportSeqno++,a=concat(int32(8+a.byteLength+4),int32(b),a),b=crc32(a),concat(a,b)},transportHeader:function(){if(!this.obfuscate)return this.transportHeaders[this.transportName];var a=this.transportHeaders[this.transportName];null==a&&(a=randomBytes(4));1==a.byteLength&&(a=repeatByte(a,4));this.debugBinary("transportHeader:",a);for(var b=int16(this.DC),c;c=concat(randomBytes(56),a,b,randomBytes(2)),"ef"==S(c.slice(0,1))||0<="44414548 54534f50 20544547 4954504f dddddddd eeeeeeee 9a974148 efefefef".split(" ").indexOf(S(c.slice(0,
4)))||"00000000"==S(c.slice(4,8)););var d=reverse(c);a=c.slice(8,40);b=c.slice(40,56);var f=d.slice(8,40);d=d.slice(40,56);this.encryption=new aesjs.ModeOfOperation.ctr(new Uint8Array(a),new Uint8Array(b));this.decryption=new aesjs.ModeOfOperation.ctr(new Uint8Array(f),new Uint8Array(d));return concat(c.slice(0,56),this.encrypt(c).slice(56,64))}});
function putMethod(a,b,c){if(0<=a.indexOf("#")){var d=(new Int32Array(reverse(B(a.substring(a.indexOf("#")+1)))))[0];a=a.substring(0,a.indexOf("#"))}else d=obtainID(a,b,c);window.Schema.methods.push({id:d.toString(),method:a,params:b,type:c})}
function putType(a,b,c){if(0<=a.indexOf("#")){var d=(new Int32Array(reverse(B(a.substring(a.indexOf("#")+1)))))[0];a=a.substring(0,a.indexOf("#"))}else d=obtainID(a,b,c);window.Schema.constructorsIndex[d]=window.Schema.constructors.length;window.Schema.constructors.push({id:d.toString(),predicate:a,params:b,type:c})}function readAsArrayBuffer(a,b){a instanceof ArrayBuffer?b(a):a instanceof Blob?readBlob(a,b):console.warn("received unknown message type:",a)}
function readBlob(a,b){if("function"===typeof a.arrayBuffer)a.arrayBuffer().then(b);else{var c=new FileReader;c.onloadend=function(a){a.target.readyState==FileReader.DONE&&b(a.target.result)};c.readAsArrayBuffer(a)}}function obtainID(a,b,c){a=[a];for(var d=0;d<b.length;++d)a.push(b[d].name+":"+b[d].type);a.push("=",c);return CRC32.str(a.join(" "))}function serializeMethod(a,b){var c=new TLSerialization;c.storeMethod(a,b);return c.getBuffer()}
function serializeObject(a,b){for(var c=null,d=0;d<window.Schema.constructors.length;++d)if(window.Schema.constructors[d].predicate===a){c=window.Schema.constructors[d].type;break}if(null==c)return console.warn('no type for "'+a+'" found'),null;d=new TLSerialization;b._=a;d.storeObject(b,c);return d.getBuffer()}function selectPublicKey(a,b){for(var c=0;c<b.length;++c)for(var d=S(b[c]),f=0;f<a.length;++f)if(a[f].fingerprint==d)return a[f];return null}
function publicKeyFingerprint(a){var b=new TLSerialization;b.storeBytes(B(a.modulus),"n");b.storeBytes(B(a.exponent),"e");return S(B(sha1(b.getBuffer())).slice(-8))}function crc32(a){return int32(CRC32.buf(new Uint8Array(a)))}function encryptRSA(a,b){var c=bigInt(b.modulus,16),d=bigInt(b.exponent,16),f=bigInt(S(a),16);return B(EuclideanModPow(f,d,c).toString(16),256)}
function xor(a,b){for(var c=new Uint8Array(a),d=new Uint8Array(b),f=new Uint8Array(c.length),g=0;g<c.length;++g)f[g]=c[g]^d[g];return f.buffer}function or(a,b){for(var c=new Uint8Array(a),d=new Uint8Array(b),f=new Uint8Array(c.length),g=0;g<c.length;++g)f[g]=c[g]|d[g];return f.buffer}function EuclideanModPow(a,b,c,d){if(d)a.modPow(b,c,function(a){d(a.isNegative()?a.add(c):a)});else return a=a.modPow(b,c),a.isNegative()?a.add(c):a}
function reverse(a){for(var b=new Uint8Array(a),c=new Uint8Array(a.byteLength),d=0;d<a.byteLength;++d)c[a.byteLength-1-d]=b[d];return c.buffer}function str(a){a=a.toString(16);1==a.length%2&&(a="0"+a);return a}function B(a,b){var c=a.match(/[0-9a-f]{2}/gi);if(null==c)return new ArrayBuffer;"number"!==typeof b&&(b=c.length);for(var d=new Uint8Array(b),f=0;f<b-c.length;++f)d[f]=0;for(f=0;f<c.length;++f)d[f+(b-c.length)]=parseInt(c[f],16);return d.buffer}
function B64(a){a=window.atob(a);for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b.buffer}function S(a,b){return arr(new Uint8Array(a)).map(function(a){a=a.toString(16);return repeatString("0",2-a.length)+a}).join(b||"")}function S64(a){return window.btoa(a)}function Braw(a){for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}
function Sraw(a){var b="";a=new Uint8Array(a);for(var c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function concat(){for(var a=arr(arguments),b=0,c=0;c<a.length;++c)b+=a[c].byteLength;b=new Uint8Array(b);for(var d=c=0;c<a.length;++c)b.set(new Uint8Array(a[c]),d),d+=a[c].byteLength;return b.buffer}function repeatString(a,b){if(a.repeat)return a.repeat(b);for(var c="",d=0;d<b;++d)c+=a;return c}function zeroBytes(a){return(new Uint8Array(a)).buffer}
function rand(a,b){return Math.round(Math.random()*(b-a))+a}function randomBytes(a){for(var b=new Uint8Array(a),c=0;c<a;++c)b[c]=rand(0,255);return b.buffer}function secureRandomBytes(a){return window.crypto&&window.crypto.getRandomValue?(a=new Uint8Array(a),window.crypto.getRandomValue(a),a.buffer):randomBytes(a)}function repeatByte(a,b){a instanceof ArrayBuffer&&(a=new Uint8Array(a));for(var c=new Uint8Array(b),d=0;d<b;++d)c[d]=a;return c.buffer}
function bytesToWords(a){a instanceof ArrayBuffer&&(a=new Uint8Array(a));var b=a.length,c=[],d;for(d=0;d<b;d++)c[d>>>2]|=a[d]<<24-d%4*8;return new CryptoJS.lib.WordArray.init(c,b)}function bytesFromWords(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(b[d>>>2]>>>24-d%4*8&255);return c}
function decomposePQ(a,b){function c(a){if(0!=k.compare(bigInt(1)))a();else{x=f;for(var b=bigInt(1);1>b.compare(e);b=b.plus(1))f=f.multiply(f).divmod(d).remainder.plus(g).divmod(d).remainder;for(var l=bigInt(0);l<e&&1==k;){ys=f;for(b=bigInt(1);1>b.compare(bigInt.min(h,e.minus(l)));b=b.plus(1))f=f.multiply(f).divmod(d).remainder.plus(g).divmod(d).remainder,m=m.multiply(x.minus(f).abs()).divmod(d).remainder;k=bigInt.gcd(m,d);l=l.plus(h)}e=e.multiply(2);$n(function(){c(a)})}}var d=bigInt("string"===
typeof a?a:S(a),16);if(0==d.divmod(2).remainder)b({p:(2).toString(16),q:d.divmod(2).quotient.toString(16)});else{var f=bigInt(rand(1,1E3)),g=bigInt(rand(1,1E3)),h=bigInt(rand(1,1E3)),k=bigInt(1),e=bigInt(1),m=bigInt(1);x=bigInt();ys=bigInt();c(function(){if(k==d){var a=function(b){ys=ys.multiply(ys).divmod(d).remainder.plus(g).divmod(d).remainder;k=k.multiply(x.minus(ys).abs()).divmod(d).remainder;-1!=k.compare(1)?$n(function(){a(b)}):b()};a(function(){b({p:k.toString(16),q:d.divmod(k).quotient.toString(16)})})}else b({p:k.toString(16),
q:d.divmod(k).quotient.toString(16)})})}}function uint8(a){return(new Uint8Array([a])).buffer}function int8(a){return(new Int8Array([a])).buffer}function int16(a){return(new Int16Array([a])).buffer}function int32(a){return(new Int32Array([a])).buffer};