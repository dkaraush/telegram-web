function closeApp(){$addclass($("#app"),"hidden");$t(200,function(){$("#app").style.display="none"});updateStatus(!1)}function startApp(){$("#app").style.display="block";$t(16,function(){$rmclass($("#app"),"hidden")});$ev($win,"beforeunload",closeApp);$onload(function(){call("messages.getDialogs",{offset_id:0,offset_peer:{_:"inputPeerEmpty"},offset_date:0,limit:12,hash:0},receiveDialogs.bind(this,0));updateStatus(!0)})}
function formatLastMessageDate(a,c){var b=new Date,e=Date.now()/1E3,d=new Date(1E3*a),f=b.toDateString(),h=d.toDateString();if(f==h)return b=d.getHours(),d=d.getMinutes(),10>b&&(b="0"+b),10>d&&(d="0"+d),b+":"+d;if(518400>e-a)return"Mon Tue Wed Thu Fri Sat Sun".split(" ")[d.getDay()-1];if(b.getFullYear()==d.getFullYear())return a=d.getDate(),b=d.getMonth(),a+" "+"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dev".split(" ")[b];a=d.getDate();b=d.getMonth()+1;d=d.getFullYear()-2E3;10>a&&(a="0"+a);10>b&&
(b="0"+b);return b+"."+a+"."+d}
var serviceTitles={ChatCreate:"{ouser} created the group \u00ab{title}\u00bb",ChatEditTitle:"{ouser} changed group name to \u00ab{title}\u00bb",ChatEditPhoto:"{ouser} updated group photo",ChatDeletePhoto:"{ouser} removed group photo",ChatAddUser:"{users} joined the group",ChatDeleteUser:"{user} left group",ChatJoinedByLink:"{user} joined by {inviter}'s link",ChannelCreate:"Channel created",ChatMigrateTo:"Group migrated to supergroup",ChannelMigrateFrom:"Channel migrated to \u00ab{chat}\u00bb",PinMessage:"{ouser} pinned message",
HistoryClear:"History was cleared",GameScore:"Scored {score}",PaymentSentMe:"Payment sent to you",PaymentSent:"Payment sent",PhoneCall:"Phone call",ScreenshotTaken:"Screenshot taken",CustomAction:"{message}",BotAllowed:"Logged in {domain}",SecureValuesSentMe:"Secure values",SecureValuesSent:"Secure values",ContactSignUp:"Signed up in Telegram!"};
function shortMessageElement(a,c){if(null==a||"messageEmpty"==a._)return"";var b=a.message;if("message"==a._){b=$new("span",shorttext(b,100));if("u"==c.type||"c"==c.type){if(a.pFlags.out)return[$new("span.active","You: "),b];if("u"==c.type)return[b];var e=users[a.from_id];return e?[$new("span.active",title(e)+": "),b]:[b]}return[b]}return"messageService"==a._?[$new("span.active",messageServiceContent(a,c))]:[]}function shorttext(a,c){return a.length<=(c||20)?a:a.slice(0,c||20)+"..."}
function messageServiceContent(a,c){var b=a.action,e=serviceTitles[b._.slice(13)]||"",d={users:function(){return map(b.users,function(a){return title(users[a])}).join(", ")},ouser:function(){return title(users[a.from_id])},user:function(){return title(users[b.user_id])},chat:function(){return title(chats[b.chat_id])},channel:function(){return title(chats[b.channel_id])},message:function(){return shorttext((c.messages[b.message_id]||{message:""}).message)},domain:function(){return b.domain},score:function(){return b.score},
inviter:function(){return title(users[b.inviter_id])},title:function(){return b.title}},f;for(f in d)0<=e.indexOf("{"+f+"}")&&(e=e.replace(new RegExp("{"+f+"}"),d[f]()));return e||""}var dialogListeners=[],userColors="#8365ab #539e4f #ae9661 #4979a3 #b7635d #b3577a #5397b4 #c07844".split(" ");
function peerImage(a){var c=a.user||a.chat,b=[$new("div.empty",c?c["short"]:"",[],function(b){b.style.backgroundColor=userColors[parseInt(a.id.slice(1))%userColors.length]}),$new("span")];c&&null!=c.photo&&null!=c.photo.src&&b.push(_peerImage(a));return b}function _peerImage(a,c){var b=a.user||a.chat;return $new("img",null,[],function(a){a.src=b.photo.src;c&&(a.style.opacity=0,$t(16,function(){a.style.opacity=1}))})}
function dialogElement(a,c){var b=c||a.messages[a.top_message],e,d,f,h,k,g=a.user||a.chat;dialogListeners.push(a.id+"-"+a.listenDialog(function(a){var b=e.querySelector(".picture"),g=a.user||a.chat;if(g.photo&&null!=g.photo.src&&null==b.querySelector("img")){var l=_peerImage(a,!0);b.appendChild(l)}g.status&&$setclass(b,"online","userStatusOnline"==g.status._);f.innerText=g.title;g.verified&&f.appendChild(svg("verified","verified"));(b=c||a.messages[a.top_message])&&d.id!="m--"+b.id&&(h.innerText=
formatLastMessageDate(b.date),k.innerHTML="",$append(k,shortMessageElement(b,a)),d.id="m--"+b.id)}));return e=$new("div.dialog#"+a.id+(g&&g.status&&"userStatusOnline"==g.status._?".online":""),null,[$new("div.picture",null,peerImage(a)),d=$new("div.info"+(b?"#m--"+b.id:""),null,[f=$new("h2",g?g.title:"",[g&&g.verified?svg("verified","verified"):null]),h=$new("span.date",formatLastMessageDate(b.date,a)),k=$new("span.content",null,shortMessageElement(b,a)),a.pinned?svg("pin","pin"):null])],UI.addRipple,
$click(function(){openPeer(a)}))}var dialogContainer=$("#left-sidebar .dialogs");function renderDialogs(){clearDialogs();for(var a=0;a<dialogs.length;++a)dialogContainer.appendChild(dialogElement(peers[dialogs[a]]))}function clearDialogs(){dialogContainer.innerHTML="";for(var a=0;a<dialogListeners.length;++a){var c=dialogListeners[a],b=c.slice(0,c.indexOf("-"));c=c.slice(c.indexOf("-")+1);peers[b].forgetDialog(c)}}
function appendNewDialogs(){for(var a=0;a<dialogs.length;++a)$("#"+dialogs[a])||dialogContainer.appendChild(dialogElement(peers[dialogs[a]]));loadingNewDialogs=!1}var loadingNewDialogs=!1;
$ev(dialogContainer,["scroll"],function(){if(dialogContainer.scrollTop+dialogContainer.clientHeight>=dialogContainer.scrollHeight-10*window.devicePixelRatio&&!loadingNewDialogs&&dialogsCount!=dialogs.length){loadingNewDialogs=!0;var a=peers[dialogs[dialogs.length-1]],c=a.messages[a.top_message],b={_:"inputPeer"+{u:"User",C:"Channel",c:"Chat"}[a.id[0]]};b[{u:"user_id",C:"channel_id",c:"chat_id"}[a.id[0]]]=a.id.slice(1);call("messages.getDialogs",{offset_date:c.date,offset_peer:b,offset_id:a.id.slice(1),
limit:12,hash:0},receiveDialogs.bind(this,dialogs.length))}});var leftsidebarSwitching=!1;function leftsidebarSwitch(a){if(!leftsidebarSwitching){leftsidebarSwitching=!0;var c=$("#left-sidebar ."+$("#left-sidebar").className);$t(200,function(){leftsidebarSwitching=!1;c.style.display="none"});$("#left-sidebar ."+a).style.display="block";$n(function(){$("#left-sidebar").className=a})}}var lastSearchQuery="",searchInput=$("#left-sidebar .searchbox input");
$ev(searchInput,["change","keyup","focus"],function(){var a=searchInput.value;lastSearchQuery!=a&&(lastSearchQuery=a,0<a.length&&"search"!=$("#left-sidebar").className?leftsidebarSwitch("search"):0==a.length&&"search"==$("#left-sidebar").className&&leftsidebarSwitch("dialogs"),0<a.length&&proto.sendAPIMethod("messages.searchGlobal",{q:a,offset_rate:0,offset_peer:{_:"inputPeerEmpty"},offset_id:0,limit:20},receiveSearchResult))});var searchResults=$(".content .search div");
function receiveSearchResult(a,c){if(a){c.users&&pushUsers(c.users);c.chats&&pushChats(c.chats);searchResults.innerHTML="";for(var b=0;b<c.messages.length;++b){var e=c.messages[b].to_id,d=peerID(e);if(!peers[d]){var f={};"u"==d[0]?f.user=users[e.user_id]:f.chat=chats[parseInt(d.slice(1))];peers[d]=new Peer(e,f)}peers[d].putMessages([c.messages[b]],!1,!0,!0);searchResults.appendChild(dialogElement(peers[d],c.messages[b]))}}};